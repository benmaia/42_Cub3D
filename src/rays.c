#include "../incs/Cub3d.h"

void cast_rays(t_mlx *m)
{
	int mx,my,mp,dof;
	float rx,ry,ra,xo,yo;
    int map[576]={
    1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,1,0,1,0,1,0,0,0,1,
    1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,1,0,0,0,1,0,0,0,1,1,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,1,1,0,1,1,0,0,0,0,1,0,1,0,1,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,1,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,1,
    1,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,1,
    1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
    1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
    };
	ra = m->p->ang;
	int i = 0;
	while(i < 1)
	{
		float atan = -1/tan(ra);
		if (ra > PI)
		{
			ry = ((m->p->y >> 6)<<6)-0.00001;
			rx = (m->p->y - ry) * atan + m->p->x;
			yo = -64;
			xo = -yo* atan;
		}
		if (ra < PI)
		{
			ry = ((m->p->y >> 6)<<6)+64;
			rx = (m->p->y - ry) * atan + m->p->x;
			yo = 64;
			xo = -yo* atan;
		}
		if (ra == 0 || ra == PI)
		{
			rx = m->p->x;
			ry = m->p->y;
			dof = 8;
		}
		while(dof < 8)
		{
			mx = (int) (rx)>>6;
			my = (int) (ry)>>6;
			mp = my * MAP_WIDTH + mx;
			if (mp < MAP_WIDTH * MAP_HEIGHT && map[mp] == 1)
			{
				dof = 8;
			}
			else
			{
				rx += xo;
				ry += yo;
				dof++;
			}
			mlx_line_to(m, m->p->x,m->p->y,rx, ry,rgb_to_int(0,255,0));
		}
	}
}